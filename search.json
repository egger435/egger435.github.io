[{"title":"egger-first-blog","url":"/2025/08/29/egger-first-blog/","content":"超级无敌大测试\n"},{"title":"Unity接入TapPlay测试不通过的解决方案","url":"/2025/09/03/Unity%E6%8E%A5%E5%85%A5TapPlay%E6%B5%8B%E8%AF%95%E4%B8%8D%E9%80%9A%E8%BF%87%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/","content":"暑期时候参加了学院的社会实践，任务是制作一款跟非遗传承相关的小游戏。当我和团队一起开发完成之后，想要上架TapTap。结果在接入TapPlay测试的时候出现了问题。\n\n\n问题来源第一次上传游戏包体的时候，由于不清楚目前游戏审核的形势，所以没有添加游戏开始前隐私政策的弹窗。因此TapTap那边的工作人员找到我，要求我在Unity程序启动前添加隐私政策弹窗。\n\n  \n\n\n当我根据官方提供的解决方案对我的项目重新进行打包，然后提交TapPlay测试的时候，遇到了TapPlay有些机型测试不通过的情况，在接入隐私政策弹窗之后部分机型打开游戏会发生闪退。提供的检测报告中只提供了错误日志，这对我没有接触过安卓开发的人很是苦恼。\n尝试各种解决方案后来我硬着头皮看错误日志，又是问ai又是google bing的，找到的解决方案基本都没有什么用，可能我这个问题也比较小众。实在没招了，我去TapTap开发者平台提交工单，结果工单半天不回复，最后回复一个正在联系技术人员，这我得等到什么时候。\n后来刷知乎时候看见评论区有位老哥似乎和我遇到了同类型的问题，作者说隐私政策需要改成不使用本地网页。这给了我一个突破点。于是我先根据这位知乎老哥的解决方案进行尝试，cv他的代码后再次打包提交测试，结果还是不通过，shift！\n最后解决方案后来我就想，要不我根本就不要使用网页了，我直接把隐私政策文本作为字符串放在unity启动项之前的PrivacyActivity.java这个启动项里面。由于最开始使用的是webview控件用于显示文本，因此第一次打包的时候我没有注意直接用”\\n”来换行了，所以打包出来后的隐私政策弹窗里面的文字相当杂乱无章，可读性极差。但是我并没有立即修改，而是先尝试提交TapPlay平台用于测试，来验证我这个想法的正确性。\n半个小时后，测试结果出来了，竟然测试通过了，哈哈哈。看来我这个想法没有问题。于是我开始对webview控件里显示的文字进行排版，然后打包后再次提交测试。结果竟然测试又不通过了，还是同样的机型，同样的闪退问题。\n难道是webview的问题吗，我把webview删掉，使用textview控件来展示隐私政策文本，然后使用”\\n”来换行。最后打包提交测试，没想到通过了！！\npackage com.unity3d.player;\nimport android.app.Activity;\nimport android.app.AlertDialog;\nimport android.content.DialogInterface;\nimport android.content.Intent;\nimport android.content.SharedPreferences;\nimport android.content.pm.ActivityInfo;\nimport android.content.pm.PackageManager;\nimport android.os.Bundle;\nimport android.widget.ScrollView;\nimport android.widget.TextView;\n \npublic class PrivacyActivity extends Activity implements DialogInterface.OnClickListener &#123;\n    final String privacyContext = &quot;隐私政策文本。。。&quot;;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) &#123;\n        super.onCreate(savedInstanceState);\n \n        //如果已经同意过隐私协议则直接进入Unity Activity\n        if (GetPrivacyAccept())&#123;\n            EnterUnityActivity();\n            return;\n        &#125;\n        ShowPrivacyDialog();//弹出隐私协议对话框\n    &#125;\n \n    @Override\n    public void onClick(DialogInterface dialogInterface, int i) &#123;\n        switch (i)&#123;\n            case AlertDialog.BUTTON_POSITIVE://点击同意按钮\n                SetPrivacyAccept(true);\n                EnterUnityActivity();//启动Unity Activity\n                break;\n            case AlertDialog.BUTTON_NEGATIVE://点击拒绝按钮,直接退出App\n                finish();\n                break;\n        &#125;\n    &#125;\n    private void ShowPrivacyDialog()&#123;\n        ScrollView scrollView = new ScrollView(this);\n        TextView textView = new TextView(this);\n        textView.setText(privacyContext);\n        scrollView.addView(textView);\n        AlertDialog.Builder privacyDialog = new AlertDialog.Builder(this);\n        privacyDialog.setCancelable(false);\n        privacyDialog.setView(scrollView);\n        privacyDialog.setTitle(&quot;用户条款与隐私&quot;);\n        privacyDialog.setNegativeButton(&quot;取消&quot;,this);\n        privacyDialog.setPositiveButton(&quot;确认&quot;,this);\n        privacyDialog.create().show();\n    &#125;\n//启动Unity Activity\n    private void EnterUnityActivity()&#123;\n        Intent unityAct = new Intent();\n        unityAct.setClassName(this, &quot;com.unity3d.player.UnityPlayerActivity&quot;);\n        this.startActivity(unityAct);\n    &#125;\n//保存同意隐私协议状态\n    private void SetPrivacyAccept(boolean accepted)&#123;\n        SharedPreferences.Editor prefs = this.getSharedPreferences(&quot;PlayerPrefs&quot;, MODE_PRIVATE).edit();\n        prefs.putBoolean(&quot;PrivacyAccepted&quot;, accepted);\n        prefs.apply();\n    &#125;\n    private boolean GetPrivacyAccept()&#123;\n        SharedPreferences prefs = this.getSharedPreferences(&quot;PlayerPrefs&quot;, MODE_PRIVATE);\n        return prefs.getBoolean(&quot;PrivacyAccepted&quot;, false);\n    &#125;\n&#125;\n\n总之就是，使用webview控件在有些机型上就会出现奇怪的问题，把它删掉就好了。虽然这样看来这种做法有点粗糙，但是想要快点通过TapPlay测试然后上架的话，也不失为一种可以尝试的途径，既不需要复杂的配置，也不需要深入了解太多的东西，只需要纯粹地添加字符串就行。\n"}]